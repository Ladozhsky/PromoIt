@*@page "/login"*@
@using System.Net.Http;
@using System.Net.Http.Json;
@using PromoItFront.Data;
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthStateProvider
@inject IJSRuntime JSRuntime


<h1>Log in to the system</h1>

<form method="post" @onsubmit="@SubmitForm">
    <div class="form-group">
        <label for="username">Username</label>
        <input type="text" class="form-control" id="username" @bind="@user.userName" required />
    </div>
    <div class="form-group">
        <label for="password">Password</label>
        <input type="password" class="form-control" id="password" @bind="@user.password" required />
    </div>
    <button type="submit" class="btn btn-primary">Log in</button>
</form>

@code {
    private string ErrorMessage { get; set; }

    LoginUser user = new LoginUser();

    private async Task SubmitForm()
    {
        try
        {

            HttpClient client = new HttpClient();

            HttpResponseMessage response = await client.PostAsJsonAsync("http://localhost:15039/api/Auth/login", user);
            if (response.IsSuccessStatusCode)
            {
                response.EnsureSuccessStatusCode();

                await AuthStateProvider.GetAuthenticationStateAsync();

                NavigationManager.NavigateTo("/campaigns");
            }
            else
            {
                object error = await response.Content.ReadAsStringAsync();
                Console.WriteLine(error);
                await JSRuntime.InvokeAsync<object>("alert", error);
            }
        }
        catch (HttpRequestException ex)
        {
            ErrorMessage = ex.Message;
        }
    }
}
